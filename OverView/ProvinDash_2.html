<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ù…Ø¯ÛŒØ±Ø§Ù† Ú©Ù„ Ø§Ø³ØªØ§Ù†ÛŒ</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;500;700;900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    
    <style>
        /* Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø±Ù†Ú¯ÛŒ Ø¨Ø±Ø§ÛŒ ÛŒÚ©Ù¾Ø§Ø±Ú†Ú¯ÛŒ */
        :root {
            --primary-color: #0d6efd; /* Ø¢Ø¨ÛŒ Ø´ÛŒÚ© */
            --secondary-color: #16a085; /* Ø³Ø¨Ø² */
            --background-color: #f8f9fa;
            --card-bg: #ffffff;
            --border-radius: 12px; /* Ú©Ù…ÛŒ Ø¨Ø²Ø±Ú¯ØªØ± */
            --current-bar-color: rgba(13, 110, 253, 0.8); /* Ø¢Ø¨ÛŒ Ø¬Ø§Ø±ÛŒ */
            --previous-bar-color: rgba(108, 117, 125, 0.3); /* Ø®Ø§Ú©Ø³ØªØ±ÛŒ Ù‚Ø¨Ù„ */
        }

        body {
            font-family: 'Vazirmatn', Tahoma, sans-serif;
            background-color: var(--background-color);
            margin: 0;
            padding: 20px; /* Ù¾Ø¯ÛŒÙ†Ú¯ Ø¨ÛŒØ´ØªØ± */
            color: #343a40;
            direction: rtl;
        }

        .header {
            text-align: center;
            margin-bottom: 40px; /* ÙØ§ØµÙ„Ù‡ Ø¨ÛŒØ´ØªØ± */
            padding: 25px;
            background: linear-gradient(135deg, var(--primary-color), #004085);
            color: white;
            border-radius: var(--border-radius);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); /* Ø§Ù†Ø¯Ø§Ø²Ù‡ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ Ú©Ù…ÛŒ Ø¨Ø²Ø±Ú¯ØªØ± */
            gap: 25px;
        }

        .director-card {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            padding: 20px; /* Ù¾Ø¯ÛŒÙ†Ú¯ Ø¯Ø§Ø®Ù„ÛŒ Ø¨ÛŒØ´ØªØ± */
            display: flex;
            flex-direction: column;
            align-items: flex-end; 
            text-align: right;
            border-top: 6px solid var(--primary-color);
        }

        .director-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }

        .director-info {
            width: 100%;
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px dashed #e9ecef;
            padding-top: 5px; 
        }

        .director-image {
            width: 70px; /* ğŸ’¡ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø¨Ø²Ø±Ú¯ØªØ± (Ù‚Ø¨Ù„ÛŒ 60px Ø¨ÙˆØ¯) */
            height: 70px;
            border-radius: 50%;
            object-fit: cover;
            margin-left: 20px;
            border: 3px solid var(--secondary-color);
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);
            display: block; 
        }

        .province-name {
            font-size: 1.2em; /* ğŸ’¡ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ÙÙˆÙ†Øª Ø¨Ø²Ø±Ú¯ØªØ± (Ù‚Ø¨Ù„ÛŒ 1.1em Ø¨ÙˆØ¯) */
            font-weight: 700;
            color: var(--primary-color);
        }

        .director-name {
            font-size: 1.0em; /* ğŸ’¡ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ÙÙˆÙ†Øª Ø¨Ø²Ø±Ú¯ØªØ± (Ù‚Ø¨Ù„ÛŒ 0.9em Ø¨ÙˆØ¯) */
            color: #6c757d;
            margin-top: 5px;
        }

        /* Ù†Ù…Ø§ÛŒØ´ Ù†Ù…Ø±Ù‡ Ú©Ù„ (Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† 5 Ø´Ø§Ø®Øµ) Ùˆ Ø±ÙˆÙ†Ø¯ */
        .main-score-container { 
            width: 100%;
            display: flex;
            justify-content: flex-end;
            align-items: center;
            margin-bottom: 15px;
            padding: 5px 0;
            font-size: 1.2em;
        }
        
        .overall-score { 
            font-weight: 900; /* ğŸ’¡ Ø¨ÙˆÙ„Ø¯ØªØ± Ø´Ø¯Ù† Ù†Ù…Ø±Ù‡ Ú©Ù„ */
            font-size: 1.8em; /* ğŸ’¡ Ø¨Ø²Ø±Ú¯ØªØ± Ø´Ø¯Ù† Ù†Ù…Ø±Ù‡ Ú©Ù„ */
            color: var(--secondary-color);
            margin-left: 15px;
        }
        
        .trend-marker {
            font-size: 1.0em; 
            font-weight: 700;
            padding: 5px 10px;
            border-radius: 5px;
            min-width: 50px;
            text-align: center;
            margin-right: 15px;
        }

        .trend-positive {
            background-color: #d4edda;
            color: #155724;
        }

        .trend-negative {
            background-color: #f8d7da;
            color: #721c24;
        }

        .chart-container {
            width: 100%;
            height: 170px; /* Ø§Ø±ØªÙØ§Ø¹ Ø¨ÛŒØ´ØªØ± Ø¨Ø±Ø§ÛŒ Ù†Ù…ÙˆØ¯Ø§Ø± */
            margin-top: 10px;
        }
        
        /* Ø§ØµÙ„Ø§Ø­ Legend Ù¾Ø§ÛŒÛŒÙ† Ù†Ù…ÙˆØ¯Ø§Ø± */
        .chart-legend {
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.85em;
            color: #6c757d;
            margin-top: 10px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin: 0 10px;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 3px;
            margin-left: 5px;
            border: 1px solid #ccc;
        }
        
        .loading-text {
            text-align: center;
            grid-column: 1 / -1;
            font-size: 1.5em;
            color: #6c757d;
            padding: 60px;
        }

        /* Modal Styles (ØªØºÛŒÛŒØ±Ø§Øª Ø¬Ø²Ø¦ÛŒ Ø¨Ø±Ø§ÛŒ ÙÙˆÙ†Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø²Ø±Ú¯ØªØ±) */
        .modal-header .province-name { font-size: 1.6em; }
        .modal-header .director-name { font-size: 1.1em; }
        .sub-indicator-item { font-size: 1.0em; }
    </style>
</head>
<body>

    <div class="header">
        <h1>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ù…Ø¯ÛŒØ±Ø§Ù† Ú©Ù„ Ø§Ø³ØªØ§Ù†ÛŒ</h1>
        <p>Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¯ÙˆØ±Ù‡ Ø¬Ø§Ø±ÛŒ Ø¨Ø§ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø¯ÙˆØ±Ù‡ Ù‚Ø¨Ù„ Ø¯Ø± Ø³Ø±Ø´Ø§Ø®Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ</p>
    </div>

    <div class="container" id="cards-container">
        <div class="loading-text">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§...</div>
    </div>

    <div id="directorModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal()">&times;</span>
            <div id="modal-header-content" class="modal-header">
            </div>
            <div id="modal-sub-indicators">
            </div>
        </div>
    </div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbwKdxgCnzDL_HwWXwNNDgU8ZVsxG8LVfHKrbtWhysDBy23LhG3QWnZvDYrOuWR-zOA7/exec";
        const CARDS_CONTAINER = document.getElementById('cards-container');
        const MODAL = document.getElementById('directorModal');
        
        const SUB_INDICATORS = [
            "Û±. Ø±Ù‡Ø¨Ø±ÛŒ Ù…ÙˆØ«Ø±", "Û². Ø§Ù†Ú¯ÛŒØ²Ù‡ Ú©Ø§Ø±Ú©Ù†Ø§Ù†", "Û³. Ø¹Ø¯Ø§Ù„Øª Ø¯Ø± Ø§Ù†ØªØµØ§Ø¨Ø§Øª", 
            "Û´. Ú©ÛŒÙÛŒØª ÙÙ†ÛŒ", "Ûµ. Ù¾ÛŒØ´Ø±ÙØª Ù…Ø§Ù„ÛŒ", 
            "Û¶. Ø¬Ø°Ø¨ Ø§Ø¹ØªØ¨Ø§Ø±Ø§Øª", "Û·. Ø´ÙØ§ÙÛŒØª Ù…Ø§Ù„ÛŒ", 
            "Û¸. ØªØ¹Ø§Ù…Ù„ Ø¨Ø§ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±ÛŒ", "Û¹. ØªØ¹Ø§Ù…Ù„ Ø¨Ø§ Ø³ØªØ§Ø¯", 
            "Û±Û°. Ù¾Ø§Ø³Ø®Ú¯ÙˆÛŒÛŒ Ø¨Ù‡ Ù…Ø±Ø¯Ù…" 
        ];
        
        const MAIN_INDICATORS = [
            'Ø±Ù‡Ø¨Ø±ÛŒØŒ Ù…Ø¯ÛŒØ±ÛŒØª Ùˆ Ø¨Ù‡Ø¨ÙˆØ¯ Ø¹Ù…Ù„Ú©Ø±Ø¯',
            'Ø¹Ù…Ù„Ú©Ø±Ø¯ ÙÙ†ÛŒ Ùˆ Ø§Ø¬Ø±Ø§ÛŒÛŒ',
            'Ø¹Ù…Ù„Ú©Ø±Ø¯ Ù…Ø§Ù„ÛŒ Ùˆ Ø§Ù‚ØªØµØ§Ø¯ÛŒ',
            'ØªØ¹Ø§Ù…Ù„Ø§Øª Ùˆ Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª Ø³Ø§Ø²Ù…Ø§Ù†ÛŒ',
            'Ø±Ø¶Ø§ÛŒØª Ù…Ø±Ø¯Ù…ÛŒ Ùˆ Ù¾Ø§Ø³Ø®Ú¯ÙˆÛŒÛŒ Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ'
        ];
        
        let directorsData = [];

        // ØªØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø³Ø§Ø®ØªÚ¯ÛŒ (Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±)
        function generateData(rowData) {
            const currentScores = {};
            const previousAvg = {};
            const mainScores = {};
            
            const subIndicatorMap = {
                'Ø±Ù‡Ø¨Ø±ÛŒØŒ Ù…Ø¯ÛŒØ±ÛŒØª Ùˆ Ø¨Ù‡Ø¨ÙˆØ¯ Ø¹Ù…Ù„Ú©Ø±Ø¯': 3,
                'Ø¹Ù…Ù„Ú©Ø±Ø¯ ÙÙ†ÛŒ Ùˆ Ø§Ø¬Ø±Ø§ÛŒÛŒ': 2,
                'Ø¹Ù…Ù„Ú©Ø±Ø¯ Ù…Ø§Ù„ÛŒ Ùˆ Ø§Ù‚ØªØµØ§Ø¯ÛŒ': 2,
                'ØªØ¹Ø§Ù…Ù„Ø§Øª Ùˆ Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª Ø³Ø§Ø²Ù…Ø§Ù†ÛŒ': 2,
                'Ø±Ø¶Ø§ÛŒØª Ù…Ø±Ø¯Ù…ÛŒ Ùˆ Ù¾Ø§Ø³Ø®Ú¯ÙˆÛŒÛŒ Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ': 1
            };

            let subIndexCounter = 0;
            let totalCurrentScore = 0;
            let totalPreviousScore = 0;
            let totalMainIndicators = 0;
            
            for (const mainInd of MAIN_INDICATORS) {
                const count = subIndicatorMap[mainInd];
                let sumCurrent = 0;
                let sumPrev = 0;

                for (let i = 0; i < count; i++) {
                    const subLabel = SUB_INDICATORS[subIndexCounter + i];
                    let current = Math.floor(Math.random() * 41) + 60; 
                    sumCurrent += current;
                    
                    const trend = Math.floor(Math.random() * 10) - 4; 
                    let previous = current - trend;
                    if (previous < 55) previous = 55;
                    if (previous > 100) previous = 100;
                    
                    sumPrev += previous;

                    currentScores[subLabel] = current;
                    previousAvg[subLabel] = previous;
                }
                
                const mainScore = sumCurrent / count;
                mainScores[mainInd] = mainScore;
                previousAvg[mainInd] = sumPrev / count;

                totalCurrentScore += mainScore;
                totalPreviousScore += previousAvg[mainInd];
                totalMainIndicators++;

                subIndexCounter += count;
            }

            const overallAvg = totalCurrentScore / totalMainIndicators;
            const overallPrevAvg = totalPreviousScore / totalMainIndicators;
            
            return {
                mainScores: mainScores,
                currentSubScores: currentScores,
                previousAvg: previousAvg,
                overallAvg: overallAvg,
                overallPrevAvg: overallPrevAvg
            };
        }

        // ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù†Ù…ÙˆØ¯Ø§Ø± Ø³ØªÙˆÙ†ÛŒ Ø§ÙÙ‚ÛŒ (Horizontal Bar Chart)
        function createBarChart(canvasId, mainScores, previousAvg) {
            const ctx = document.getElementById(canvasId).getContext('2d');
            const dataLabels = Object.keys(mainScores);
            const currentData = Object.values(mainScores);
            const previousData = Object.values(previousAvg);
            
            const backgroundColors = currentData.map((score, index) => {
                const prev = previousData[index];
                return score >= prev ? 'rgba(13, 110, 253, 0.8)' : 'rgba(220, 53, 69, 0.8)'; 
            });

            const data = {
                labels: dataLabels.map(label => label.split(',')[0].replace(' Ùˆ', '/').replace('ØŒ', '/')),
                datasets: [
                {
                    label: 'Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø¯ÙˆØ±Ù‡ Ù‚Ø¨Ù„',
                    data: previousData,
                    backgroundColor: 'rgba(108, 117, 125, 0.3)', // Ø®Ø§Ú©Ø³ØªØ±ÛŒ
                    borderColor: 'rgba(108, 117, 125, 1)',
                    borderWidth: 1,
                },
                {
                    label: 'Ø¯ÙˆØ±Ù‡ Ø¬Ø§Ø±ÛŒ',
                    data: currentData,
                    backgroundColor: backgroundColors, // Ø¢Ø¨ÛŒ/Ù‚Ø±Ù…Ø²
                    borderColor: backgroundColors.map(color => color.replace('0.8', '1')),
                    borderWidth: 1,
                }]
            };

            const config = {
                type: 'bar',
                data: data,
                options: {
                    indexAxis: 'y', 
                    responsive: true,
                    maintainAspectRatio: false,
                    // ğŸ’¡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§Ø±Ù‡Ø§ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ú©Ù†Ø§Ø± Ù‡Ù…
                    scales: {
                        x: {
                            min: 50,
                            max: 100,
                            title: { display: false },
                            ticks: { display: false }, 
                            grid: { display: false }
                        },
                        y: {
                            ticks: { font: { size: 10, family: 'Vazirmatn' }, color: '#343a40' },
                            grid: { display: false }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            rtl: true,
                            bodyFont: { family: 'Vazirmatn' },
                            titleFont: { family: 'Vazirmatn' },
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.x.toFixed(1) + '%';
                                }
                            }
                        },
                        // ğŸ’¡ ØªÙ†Ø¸ÛŒÙ… Databales Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø±ØµØ¯ Ø¨Ø¹Ø¯ Ø§Ø² Ù…ÛŒÙ„Ù‡â€ŒÙ‡Ø§
                        datalabels: {
                            anchor: 'end',
                            align: 'right', // ğŸ’¡ ØªØ±Ø§Ø² Ø±Ø§Ø³Øª Ø¨Ø±Ø§ÛŒ Ù‚Ø±Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø¨Ø¹Ø¯ Ø§Ø² Ù…ÛŒÙ„Ù‡
                            offset: 4, // ÙØ§ØµÙ„Ù‡ Ø§Ø² Ù…ÛŒÙ„Ù‡
                            font: {
                                weight: 'bold',
                                size: 10, // ÙÙˆÙ†Øª Ú©Ù…ÛŒ Ø¨Ø²Ø±Ú¯ØªØ±
                                family: 'Vazirmatn'
                            },
                            color: function(context) {
                                // Ø±Ù†Ú¯ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø±Ù‡ Ø¬Ø§Ø±ÛŒ (Ø¢Ø¨ÛŒ) Ùˆ Ù†Ù…Ø±Ù‡ Ù‚Ø¨Ù„ (Ø®Ø§Ú©Ø³ØªØ±ÛŒ ØªÛŒØ±Ù‡)
                                return context.datasetIndex === 1 ? 'rgba(13, 110, 253, 1)' : 'rgba(108, 117, 125, 1)';
                            },
                            formatter: function(value, context) {
                                // Ù†Ù…Ø§ÛŒØ´ Ù†Ù…Ø±Ù‡ Ø¨Ø§ ÛŒÚ© Ø±Ù‚Ù… Ø§Ø¹Ø´Ø§Ø± Ùˆ Ø¯Ø±ØµØ¯
                                return value.toFixed(1) + '%'; 
                            }
                        }
                    }
                },
                plugins: [ChartDataLabels]
            };
            
            new Chart(ctx, config);
        }

        // ØªÙˆØ§Ø¨Ø¹ Modal Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±
        function showModal(directorIndex) {
            const director = directorsData[directorIndex];
            const data = director.evaluationData;
            
            let modalHeaderHtml = `
                <div>
                    <div class="province-name">${director.provinceName}</div>
                    <div class="director-name">Ù…Ø¯ÛŒØ±Ú©Ù„: ${director.directorName}</div>
                </div>
                <img src="${director.imageURL}" alt="${director.directorName}" class="director-image">
            `;
            document.getElementById('modal-header-content').innerHTML = modalHeaderHtml;

            let subIndicatorsHtml = '<ul class="sub-indicators-list">';
            let subIndexCounter = 0;
            const subIndicatorMap = {
                'Ø±Ù‡Ø¨Ø±ÛŒØŒ Ù…Ø¯ÛŒØ±ÛŒØª Ùˆ Ø¨Ù‡Ø¨ÙˆØ¯ Ø¹Ù…Ù„Ú©Ø±Ø¯': 3, 'Ø¹Ù…Ù„Ú©Ø±Ø¯ ÙÙ†ÛŒ Ùˆ Ø§Ø¬Ø±Ø§ÛŒÛŒ': 2, 'Ø¹Ù…Ù„Ú©Ø±Ø¯ Ù…Ø§Ù„ÛŒ Ùˆ Ø§Ù‚ØªØµØ§Ø¯ÛŒ': 2, 
                'ØªØ¹Ø§Ù…Ù„Ø§Øª Ùˆ Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª Ø³Ø§Ø²Ù…Ø§Ù†ÛŒ': 2, 'Ø±Ø¶Ø§ÛŒØª Ù…Ø±Ø¯Ù…ÛŒ Ùˆ Ù¾Ø§Ø³Ø®Ú¯ÙˆÛŒÛŒ Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ': 1
            };
            
            for (const mainInd of MAIN_INDICATORS) {
                const mainScore = data.mainScores[mainInd].toFixed(1);
                
                subIndicatorsHtml += `<li class="sub-indicator-item main-separator">
                    <span>${mainInd}</span>
                    <span>Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø¯ÙˆØ±Ù‡ Ø¬Ø§Ø±ÛŒ: ${mainScore}%</span>
                </li>`;

                const count = subIndicatorMap[mainInd];
                
                for(let i = 0; i < count; i++) {
                    const subLabel = SUB_INDICATORS[subIndexCounter + i];
                    const currentScore = data.currentSubScores[subLabel];
                    const prevScore = data.previousAvg[subLabel];
                    const trend = currentScore - prevScore;
                    const trendClass = trend >= 0 ? 'trend-positive' : 'trend-negative';
                    const trendIcon = trend >= 0 ? '<i class="fa fa-caret-up"></i>' : '<i class="fa fa-caret-down"></i>';
                    const trendText = `${trend.toFixed(1)}`;
                    const percentage = currentScore; 

                    subIndicatorsHtml += `
                        <li class="sub-indicator-item">
                            <span>${subLabel}</span>
                            <div class="score-bar-detail">
                                <div class="current-score-detail" style="width: ${percentage}%;">
                                    ${currentScore.toFixed(1)}%
                                </div>
                            </div>
                            <span class="trend-marker ${trendClass}">
                                ${trendIcon} ${trendText}
                            </span>
                        </li>
                    `;
                }
                subIndexCounter += count;
            }
            subIndicatorsHtml += '</ul>';
            document.getElementById('modal-sub-indicators').innerHTML = subIndicatorsHtml;

            MODAL.style.display = "block";
        }

        function closeModal() {
            MODAL.style.display = "none";
        }

        window.onclick = function(event) {
            if (event.target == MODAL) {
                closeModal();
            }
        }

        // ØªØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡ Ùˆ Ø±Ù†Ø¯Ø± Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§
        async function loadData() {
            try {
                const response = await fetch(API_URL);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const apiResult = await response.json(); 
                
                CARDS_CONTAINER.innerHTML = ''; 

                if (apiResult.status === "success" && Array.isArray(apiResult.data) && apiResult.data.length > 1) {
                    
                    directorsData = apiResult.data.slice(1).map((row, index) => {
                        const provinceName = row[0] || 'Ù†Ø§Ù…Ø´Ø®Øµ'; 
                        const directorName = row[2] || 'Ù†Ø§Ù…Ø´Ø®Øµ';
                        const imageURL = row[3] || 'https://via.placeholder.com/70/0d6efd/ffffff?text=BM'; // ØªØµÙˆÛŒØ± Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ø¨Ø§ Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø¨Ø²Ø±Ú¯ØªØ±
                        
                        const evaluationData = generateData(row);
                        
                        return {
                            provinceName,
                            directorName,
                            imageURL,
                            index, 
                            evaluationData,
                        };
                    });
                    
                    directorsData.forEach(director => {
                        const card = document.createElement('div');
                        card.className = 'director-card';
                        card.setAttribute('onclick', `showModal(${director.index})`);
                        
                        const chartId = `chart-${director.index}`;
                        const mainScores = director.evaluationData.mainScores;
                        const previousAvg = director.evaluationData.previousAvg;
                        
                        // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ú©Ù„ Ø¹Ù…Ù„Ú©Ø±Ø¯ (overallAvg)
                        const overallScore = director.evaluationData.overallAvg;
                        const overallPrev = director.evaluationData.overallPrevAvg;
                        const overallTrend = (overallScore - overallPrev).toFixed(1);
                        const trendClass = overallTrend >= 0 ? 'trend-positive' : 'trend-negative';
                        const trendIcon = overallTrend >= 0 ? '<i class="fa fa-caret-up"></i>' : '<i class="fa fa-caret-down"></i>';

                        card.innerHTML = `
                            <div class="director-info">
                                <img src="${director.imageURL}" alt="${director.directorName}" class="director-image">
                                <div>
                                    <div class="province-name">${director.provinceName}</div>
                                    <div class="director-name">${director.directorName}</div>
                                </div>
                            </div>
                            
                            <div class="main-score-container">
                                <span class="overall-score">${overallScore.toFixed(1)}%</span>
                                <span class="trend-marker ${trendClass}">
                                    ${trendIcon} ${overallTrend} 
                                </span>
                            </div>
                            
                            <div class="chart-container">
                                <canvas id="${chartId}"></canvas>
                            </div>
                            
                            <div class="chart-legend">
                                <div class="legend-item">
                                    <span>Ø¯ÙˆØ±Ù‡ Ø¬Ø§Ø±ÛŒ:</span>
                                    <span class="legend-color" style="background-color: var(--current-bar-color);"></span>
                                </div>
                                <div class="legend-item">
                                    <span>Ø¯ÙˆØ±Ù‡ Ù‚Ø¨Ù„:</span>
                                    <span class="legend-color" style="background-color: var(--previous-bar-color);"></span>
                                </div>
                            </div>
                        `;

                        CARDS_CONTAINER.appendChild(card);

                        createBarChart(
                            chartId, 
                            mainScores, 
                            previousAvg
                        );
                    });

                } else {
                    CARDS_CONTAINER.innerHTML = '<div class="loading-text" style="color: #dc3545; font-weight: 500;">Ø®Ø·Ø§: Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯ ÛŒØ§ Ø³Ø§Ø®ØªØ§Ø± API Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª.</div>';
                }

            } catch (error) {
                console.error("Error fetching data:", error);
                CARDS_CONTAINER.innerHTML = `<div class="loading-text" style="color: #dc3545; font-weight: 500;">Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±Ù‚Ø±Ø§Ø±ÛŒ Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ API: ${error.message}</div>`;
            }
        }

        loadData();
    </script>
</body>
</html>